var X={exports:{}},Se;function Ye(){return Se||(Se=1,(function(h){var o=(function(t){var n=Object.prototype,i=n.hasOwnProperty,s=Object.defineProperty||function(r,e,a){r[e]=a.value},d,m=typeof Symbol=="function"?Symbol:{},w=m.iterator||"@@iterator",S=m.asyncIterator||"@@asyncIterator",P=m.toStringTag||"@@toStringTag";function u(r,e,a){return Object.defineProperty(r,e,{value:a,enumerable:!0,configurable:!0,writable:!0}),r[e]}try{u({},"")}catch{u=function(e,a,f){return e[a]=f}}function I(r,e,a,f){var l=e&&e.prototype instanceof R?e:R,v=Object.create(l.prototype),k=new Y(f||[]);return s(v,"_invoke",{value:Z(r,a,k)}),v}t.wrap=I;function q(r,e,a){try{return{type:"normal",arg:r.call(e,a)}}catch(f){return{type:"throw",arg:f}}}var j="suspendedStart",c="suspendedYield",y="executing",E="completed",_={};function R(){}function b(){}function A(){}var N={};u(N,w,function(){return this});var W=Object.getPrototypeOf,D=W&&W(W(K([])));D&&D!==n&&i.call(D,w)&&(N=D);var M=A.prototype=R.prototype=Object.create(N);b.prototype=A,s(M,"constructor",{value:A,configurable:!0}),s(A,"constructor",{value:b,configurable:!0}),b.displayName=u(A,P,"GeneratorFunction");function x(r){["next","throw","return"].forEach(function(e){u(r,e,function(a){return this._invoke(e,a)})})}t.isGeneratorFunction=function(r){var e=typeof r=="function"&&r.constructor;return e?e===b||(e.displayName||e.name)==="GeneratorFunction":!1},t.mark=function(r){return Object.setPrototypeOf?Object.setPrototypeOf(r,A):(r.__proto__=A,u(r,P,"GeneratorFunction")),r.prototype=Object.create(M),r},t.awrap=function(r){return{__await:r}};function B(r,e){function a(v,k,O,C){var T=q(r[v],r,k);if(T.type==="throw")C(T.arg);else{var p=T.arg,g=p.value;return g&&typeof g=="object"&&i.call(g,"__await")?e.resolve(g.__await).then(function(L){a("next",L,O,C)},function(L){a("throw",L,O,C)}):e.resolve(g).then(function(L){p.value=L,O(p)},function(L){return a("throw",L,O,C)})}}var f;function l(v,k){function O(){return new e(function(C,T){a(v,k,C,T)})}return f=f?f.then(O,O):O()}s(this,"_invoke",{value:l})}x(B.prototype),u(B.prototype,S,function(){return this}),t.AsyncIterator=B,t.async=function(r,e,a,f,l){l===void 0&&(l=Promise);var v=new B(I(r,e,a,f),l);return t.isGeneratorFunction(e)?v:v.next().then(function(k){return k.done?k.value:v.next()})};function Z(r,e,a){var f=j;return function(v,k){if(f===y)throw new Error("Generator is already running");if(f===E){if(v==="throw")throw k;return V()}for(a.method=v,a.arg=k;;){var O=a.delegate;if(O){var C=U(O,a);if(C){if(C===_)continue;return C}}if(a.method==="next")a.sent=a._sent=a.arg;else if(a.method==="throw"){if(f===j)throw f=E,a.arg;a.dispatchException(a.arg)}else a.method==="return"&&a.abrupt("return",a.arg);f=y;var T=q(r,e,a);if(T.type==="normal"){if(f=a.done?E:c,T.arg===_)continue;return{value:T.arg,done:a.done}}else T.type==="throw"&&(f=E,a.method="throw",a.arg=T.arg)}}}function U(r,e){var a=e.method,f=r.iterator[a];if(f===d)return e.delegate=null,a==="throw"&&r.iterator.return&&(e.method="return",e.arg=d,U(r,e),e.method==="throw")||a!=="return"&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+a+"' method")),_;var l=q(f,r.iterator,e.arg);if(l.type==="throw")return e.method="throw",e.arg=l.arg,e.delegate=null,_;var v=l.arg;if(!v)return e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,_;if(v.done)e[r.resultName]=v.value,e.next=r.nextLoc,e.method!=="return"&&(e.method="next",e.arg=d);else return v;return e.delegate=null,_}x(M),u(M,P,"Generator"),u(M,w,function(){return this}),u(M,"toString",function(){return"[object Generator]"});function $(r){var e={tryLoc:r[0]};1 in r&&(e.catchLoc=r[1]),2 in r&&(e.finallyLoc=r[2],e.afterLoc=r[3]),this.tryEntries.push(e)}function H(r){var e=r.completion||{};e.type="normal",delete e.arg,r.completion=e}function Y(r){this.tryEntries=[{tryLoc:"root"}],r.forEach($,this),this.reset(!0)}t.keys=function(r){var e=Object(r),a=[];for(var f in e)a.push(f);return a.reverse(),function l(){for(;a.length;){var v=a.pop();if(v in e)return l.value=v,l.done=!1,l}return l.done=!0,l}};function K(r){if(r){var e=r[w];if(e)return e.call(r);if(typeof r.next=="function")return r;if(!isNaN(r.length)){var a=-1,f=function l(){for(;++a<r.length;)if(i.call(r,a))return l.value=r[a],l.done=!1,l;return l.value=d,l.done=!0,l};return f.next=f}}return{next:V}}t.values=K;function V(){return{value:d,done:!0}}return Y.prototype={constructor:Y,reset:function(r){if(this.prev=0,this.next=0,this.sent=this._sent=d,this.done=!1,this.delegate=null,this.method="next",this.arg=d,this.tryEntries.forEach(H),!r)for(var e in this)e.charAt(0)==="t"&&i.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=d)},stop:function(){this.done=!0;var r=this.tryEntries[0],e=r.completion;if(e.type==="throw")throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var e=this;function a(C,T){return v.type="throw",v.arg=r,e.next=C,T&&(e.method="next",e.arg=d),!!T}for(var f=this.tryEntries.length-1;f>=0;--f){var l=this.tryEntries[f],v=l.completion;if(l.tryLoc==="root")return a("end");if(l.tryLoc<=this.prev){var k=i.call(l,"catchLoc"),O=i.call(l,"finallyLoc");if(k&&O){if(this.prev<l.catchLoc)return a(l.catchLoc,!0);if(this.prev<l.finallyLoc)return a(l.finallyLoc)}else if(k){if(this.prev<l.catchLoc)return a(l.catchLoc,!0)}else if(O){if(this.prev<l.finallyLoc)return a(l.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(r,e){for(var a=this.tryEntries.length-1;a>=0;--a){var f=this.tryEntries[a];if(f.tryLoc<=this.prev&&i.call(f,"finallyLoc")&&this.prev<f.finallyLoc){var l=f;break}}l&&(r==="break"||r==="continue")&&l.tryLoc<=e&&e<=l.finallyLoc&&(l=null);var v=l?l.completion:{};return v.type=r,v.arg=e,l?(this.method="next",this.next=l.finallyLoc,_):this.complete(v)},complete:function(r,e){if(r.type==="throw")throw r.arg;return r.type==="break"||r.type==="continue"?this.next=r.arg:r.type==="return"?(this.rval=this.arg=r.arg,this.method="return",this.next="end"):r.type==="normal"&&e&&(this.next=e),_},finish:function(r){for(var e=this.tryEntries.length-1;e>=0;--e){var a=this.tryEntries[e];if(a.finallyLoc===r)return this.complete(a.completion,a.afterLoc),H(a),_}},catch:function(r){for(var e=this.tryEntries.length-1;e>=0;--e){var a=this.tryEntries[e];if(a.tryLoc===r){var f=a.completion;if(f.type==="throw"){var l=f.arg;H(a)}return l}}throw new Error("illegal catch attempt")},delegateYield:function(r,e,a){return this.delegate={iterator:K(r),resultName:e,nextLoc:a},this.method==="next"&&(this.arg=d),_}},t})(h.exports);try{regeneratorRuntime=o}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=o:Function("r","regeneratorRuntime = r")(o)}})(X)),X.exports}var ee,Re;function ye(){return Re||(Re=1,ee=(h,o)=>`${h}-${o}-${Math.random().toString(16).slice(3,8)}`),ee}var re,Ee;function je(){if(Ee)return re;Ee=1;const h=ye();let o=0;return re=({id:t,action:n,payload:i={}})=>{let s=t;return typeof s>"u"&&(s=h("Job",o),o+=1),{id:s,action:n,payload:i}},re}var J={},_e;function Le(){if(_e)return J;_e=1;let h=!1;return J.logging=h,J.setLogging=o=>{h=o},J.log=(...o)=>h?console.log.apply(this,o):null,J}var te,be;function Ke(){if(be)return te;be=1;const h=je(),{log:o}=Le(),t=ye();let n=0;return te=()=>{const i=t("Scheduler",n),s={},d={};let m=[];n+=1;const w=()=>m.length,S=()=>Object.keys(s).length,P=()=>{if(m.length!==0){const c=Object.keys(s);for(let y=0;y<c.length;y+=1)if(typeof d[c[y]]>"u"){m[0](s[c[y]]);break}}},u=(c,y)=>new Promise((E,_)=>{const R=h({action:c,payload:y});m.push(async b=>{m.shift(),d[b.id]=R;try{E(await b[c].apply(this,[...y,R.id]))}catch(A){_(A)}finally{delete d[b.id],P()}}),o(`[${i}]: Add ${R.id} to JobQueue`),o(`[${i}]: JobQueue length=${m.length}`),P()});return{addWorker:c=>(s[c.id]=c,o(`[${i}]: Add ${c.id}`),o(`[${i}]: Number of workers=${S()}`),P(),c.id),addJob:async(c,...y)=>{if(S()===0)throw Error(`[${i}]: You need to have at least one worker before adding jobs`);return u(c,y)},terminate:async()=>{Object.keys(s).forEach(async c=>{await s[c].terminate()}),m=[]},getQueueLen:w,getNumWorkers:S}},te}function Je(h){throw new Error('Could not dynamically require "'+h+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var oe,ke;function Ve(){return ke||(ke=1,oe=h=>{const o={};return typeof WorkerGlobalScope<"u"?o.type="webworker":typeof document=="object"?o.type="browser":typeof process=="object"&&typeof Je=="function"&&(o.type="node"),typeof h>"u"?o:o[h]}),oe}var ae,Oe;function Ze(){if(Oe)return ae;Oe=1;const o=Ve()("type")==="browser"?t=>new URL(t,window.location.href).href:t=>t;return ae=t=>{const n={...t};return["corePath","workerPath","langPath"].forEach(i=>{t[i]&&(n[i]=o(n[i]))}),n},ae}var ne,Te;function Be(){return Te||(Te=1,ne={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3}),ne}const Qe="6.0.1",Xe={version:Qe};var ie,Ae;function er(){return Ae||(Ae=1,ie={workerBlobURL:!0,logger:()=>{}}),ie}var se,Me;function rr(){if(Me)return se;Me=1;const h=Xe.version;return se={...er(),workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${h}/dist/worker.min.js`},se}var ce,Ce;function tr(){return Ce||(Ce=1,ce=({workerPath:h,workerBlobURL:o})=>{let t;if(Blob&&URL&&o){const n=new Blob([`importScripts("${h}");`],{type:"application/javascript"});t=new Worker(URL.createObjectURL(n))}else t=new Worker(h);return t}),ce}var le,Ie;function or(){return Ie||(Ie=1,le=h=>{h.terminate()}),le}var ue,Pe;function ar(){return Pe||(Pe=1,ue=(h,o)=>{h.onmessage=({data:t})=>{o(t)}}),ue}var de,qe;function nr(){return qe||(qe=1,de=async(h,o)=>{h.postMessage(o)}),de}var fe,Ne;function ir(){if(Ne)return fe;Ne=1;const h=t=>new Promise((n,i)=>{const s=new FileReader;s.onload=()=>{n(s.result)},s.onerror=({target:{error:{code:d}}})=>{i(Error(`File could not be read! Code=${d}`))},s.readAsArrayBuffer(t)}),o=async t=>{let n=t;if(typeof t>"u")return"undefined";if(typeof t=="string")/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(t)?n=atob(t.split(",")[1]).split("").map(i=>i.charCodeAt(0)):n=await(await fetch(t)).arrayBuffer();else if(typeof HTMLElement<"u"&&t instanceof HTMLElement)t.tagName==="IMG"&&(n=await o(t.src)),t.tagName==="VIDEO"&&(n=await o(t.poster)),t.tagName==="CANVAS"&&await new Promise(i=>{t.toBlob(async s=>{n=await h(s),i()})});else if(typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas){const i=await t.convertToBlob();n=await h(i)}else(t instanceof File||t instanceof Blob)&&(n=await h(t));return new Uint8Array(n)};return fe=o,fe}var he,De;function sr(){if(De)return he;De=1;const h=rr(),o=tr(),t=or(),n=ar(),i=nr(),s=ir();return he={defaultOptions:h,spawnWorker:o,terminateWorker:t,onMessage:n,send:i,loadImage:s},he}var pe,$e;function xe(){if($e)return pe;$e=1;const h=Ze(),o=je(),{log:t}=Le(),n=ye(),i=Be(),{defaultOptions:s,spawnWorker:d,terminateWorker:m,onMessage:w,loadImage:S,send:P}=sr();let u=0;return pe=async(I="eng",q=i.LSTM_ONLY,j={},c={})=>{const y=n("Worker",u),{logger:E,errorHandler:_,...R}=h({...s,...j}),b={},A=typeof I=="string"?I.split("+"):I;let N=q,W=c;const D=[i.DEFAULT,i.LSTM_ONLY].includes(q)&&!R.legacyCore;let M,x;const B=new Promise((p,g)=>{x=p,M=g}),Z=p=>{M(p.message)};let U=d(R);U.onerror=Z,u+=1;const $=({id:p,action:g,payload:L})=>new Promise((G,z)=>{t(`[${y}]: Start ${p}, action=${g}`);const F=`${g}-${p}`;b[F]={resolve:G,reject:z},P(U,{workerId:y,jobId:p,action:g,payload:L})}),H=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),Y=p=>$(o({id:p,action:"load",payload:{options:{lstmOnly:D,corePath:R.corePath,logging:R.logging}}})),K=(p,g,L)=>$(o({id:L,action:"FS",payload:{method:"writeFile",args:[p,g]}})),V=(p,g)=>$(o({id:g,action:"FS",payload:{method:"readFile",args:[p,{encoding:"utf8"}]}})),r=(p,g)=>$(o({id:g,action:"FS",payload:{method:"unlink",args:[p]}})),e=(p,g,L)=>$(o({id:L,action:"FS",payload:{method:p,args:g}})),a=(p,g)=>$(o({id:g,action:"loadLanguage",payload:{langs:p,options:{langPath:R.langPath,dataPath:R.dataPath,cachePath:R.cachePath,cacheMethod:R.cacheMethod,gzip:R.gzip,lstmOnly:[i.DEFAULT,i.LSTM_ONLY].includes(N)&&!R.legacyLang}}})),f=(p,g,L,G)=>$(o({id:G,action:"initialize",payload:{langs:p,oem:g,config:L}})),l=(p="eng",g,L,G)=>{if(D&&[i.TESSERACT_ONLY,i.TESSERACT_LSTM_COMBINED].includes(g))throw Error("Legacy model requested but code missing.");const z=g||N;N=z;const F=L||W;W=F;const Q=(typeof p=="string"?p.split("+"):p).filter(He=>!A.includes(He));return A.push(...Q),Q.length>0?a(Q,G).then(()=>f(p,z,F,G)):f(p,z,F,G)},v=(p={},g)=>$(o({id:g,action:"setParameters",payload:{params:p}})),k=async(p,g={},L={text:!0},G)=>$(o({id:G,action:"recognize",payload:{image:await S(p),options:g,output:L}})),O=async(p,g)=>{if(D)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return $(o({id:g,action:"detect",payload:{image:await S(p)}}))},C=async()=>(U!==null&&(m(U),U=null),Promise.resolve());w(U,({workerId:p,jobId:g,status:L,action:G,data:z})=>{const F=`${G}-${g}`;if(L==="resolve")t(`[${p}]: Complete ${g}`),b[F].resolve({jobId:g,data:z}),delete b[F];else if(L==="reject")if(b[F].reject(z),delete b[F],G==="load"&&M(z),_)_(z);else throw Error(z);else L==="progress"&&E({...z,userJobId:g})});const T={id:y,worker:U,load:H,writeText:K,readText:V,removeFile:r,FS:e,reinitialize:l,setParameters:v,recognize:k,detect:O,terminate:C};return Y().then(()=>a(I)).then(()=>f(I,q,c)).then(()=>x(T)).catch(()=>{}),B},pe}var me,Ge;function cr(){if(Ge)return me;Ge=1;const h=xe();return me={recognize:async(n,i,s)=>{const d=await h(i,1,s);return d.recognize(n).finally(async()=>{await d.terminate()})},detect:async(n,i)=>{const s=await h("osd",0,i);return s.detect(n).finally(async()=>{await s.terminate()})}},me}var ge,ze;function lr(){return ze||(ze=1,ge={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"}),ge}var ve,We;function ur(){return We||(We=1,ve={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"}),ve}var we,Ue;function dr(){if(Ue)return we;Ue=1,Ye();const h=Ke(),o=xe(),t=cr(),n=lr(),i=Be(),s=ur(),{setLogging:d}=Le();return we={languages:n,OEM:i,PSM:s,createScheduler:h,createWorker:o,setLogging:d,...t},we}var Fe=dr();class fr{constructor(){this.worker=null,this.nomeBeneficiario="Gustavo Santos Ribeiro",this.chavePix="12996764694",this.valorMinimo=10,this.toleranciaMinutos=5,this.ultimoProcessamento=null}async inicializarWorker(){return this.worker||(this.worker=await Fe.createWorker("por"),await this.worker.setParameters({tessedit_char_whitelist:"0123456789R$:.,/abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ√°√©√≠√≥√∫√¢√™√Æ√¥√ª√£√µ√ß√Å√â√ç√ì√ö√Ç√ä√é√î√õ√É√ï√á -",tessedit_pageseg_mode:"6",tessedit_ocr_engine_mode:"1",textord_min_linesize:"2.5",textord_space_size_is_variable:"1",language_model_ngram_on:"0",preserve_interword_spaces:"1",tessedit_create_hocr:"0",tessedit_create_boxfile:"0",user_defined_dpi:"300"})),this.worker}async processarArquivo(o){try{console.log("üîç Iniciando processamento do arquivo:",o.name),this.ultimoProcessamento=new Date;const t=await this.inicializarWorker(),n=await this.preProcessarImagemAvancado(o),{data:{text:i,confidence:s}}=await t.recognize(n,{rectangle:{top:0,left:0,width:1e3,height:1e3}});console.log("üìù Texto extra√≠do pelo OCR:",i),console.log("üéØ Confian√ßa do OCR:",s);let d=i;if(s<60){console.log("‚ö†Ô∏è Confian√ßa baixa, aplicando processamento adicional...");const S=await this.tentarMelhorarOCR(o);S&&(d=S,console.log("‚úÖ Texto melhorado ap√≥s processamento adicional"))}const m=this.analisarTexto(d);m.confiancaOCR=s;const w=this.validarTemporalmente(m.dataHora);return m.valido&&w.valido?{valido:!0,mensagem:"‚úÖ Pagamento validado com sucesso!",dados:m,tempoRestante:w.tempoRestante,confianca:s}:w.valido?s<70?{valido:!1,mensagem:"‚ùå Imagem precisa de ajustes para melhor leitura",dados:m,confianca:s}:{valido:!1,mensagem:"‚ùå Dados incompletos no comprovante.",dados:m,confianca:s}:{valido:!1,mensagem:`‚ùå Comprovante expirado. ${w.mensagem}`,dados:m,confianca:s}}catch(t){return console.error("‚ùå Erro no processamento:",t),{valido:!1,mensagem:"‚ùå Erro ao processar imagem. Use o otimizador de imagem.",dados:null,confianca:0}}}async preProcessarImagemAvancado(o){return new Promise((t,n)=>{const i=new Image,s=document.createElement("canvas"),d=s.getContext("2d",{willReadFrequently:!0});i.onload=()=>{try{let m=i.width,w=i.height;const S=2e3;if(m>S||w>S){const c=Math.min(S/m,S/w);m=Math.floor(m*c),w=Math.floor(w*c)}s.width=m,s.height=w,d.drawImage(i,0,0,m,w);const P=d.getImageData(0,0,m,w),u=P.data,I=1.8,q=30;for(let c=1;c<w-1;c++)for(let y=1;y<m-1;y++){const E=(c*m+y)*4;if(.299*u[E]+.587*u[E+1]+.114*u[E+2]<100){let R=0,b=0,A=0,N=0;for(let W=-1;W<=1;W++)for(let D=-1;D<=1;D++){const M=((c+W)*m+(y+D))*4;R+=u[M],b+=u[M+1],A+=u[M+2],N++}u[E]=R/N,u[E+1]=b/N,u[E+2]=A/N}}for(let c=0;c<u.length;c+=4){u[c]=this.clamp((u[c]-128)*I+128),u[c+1]=this.clamp((u[c+1]-128)*I+128),u[c+2]=this.clamp((u[c+2]-128)*I+128),u[c]=this.clamp(u[c]+q),u[c+1]=this.clamp(u[c+1]+q),u[c+2]=this.clamp(u[c+2]+q);const y=.299*u[c]+.587*u[c+1]+.114*u[c+2];u[c]=u[c+1]=u[c+2]=y}const j=128;for(let c=0;c<u.length;c+=4){const E=u[c]>j?255:0;u[c]=u[c+1]=u[c+2]=E}d.putImageData(P,0,0),s.toBlob(c=>{c?t(c):n(new Error("Falha ao criar blob"))},"image/jpeg",.95)}catch(m){n(m)}},i.onerror=n,i.src=URL.createObjectURL(o)})}async tentarMelhorarOCR(o){try{const t=await Fe.createWorker("por");await t.setParameters({tessedit_pageseg_mode:"3",tessedit_ocr_engine_mode:"2",preserve_interword_spaces:"0",user_defined_dpi:"400"});const{data:{text:n}}=await t.recognize(o);return await t.terminate(),n}catch(t){return console.log("‚ö†Ô∏è Falha no OCR alternativo:",t),null}}clamp(o){return Math.min(255,Math.max(0,Math.round(o)))}analisarTexto(o){const t=o.toLowerCase().replace(/\s+/g," ");console.log("üìä Analisando texto...");const n={valor:[/r\s*\$\s*(\d+[.,]\d{2})/gi,/r\$\s*(\d+[.,]\d{2})/gi,/(\d+[.,]\d{2})\s*reais/gi,/valor\s*[.:]?\s*(\d+[.,]\d{2})/gi,/total\s*[.:]?\s*(\d+[.,]\d{2})/gi,/pago\s*[.:]?\s*(\d+[.,]\d{2})/gi,/(\d+[.,]\d{2})/g],dataHora:[/(\d{2}[./-]\d{2}[./-]\d{4}\s+\d{1,2}[:.]\d{2}(?:[:.]\d{2})?)/g,/(\d{1,2}[:.]\d{2}(?:[:.]\d{2})?\s+\d{2}[./-]\d{2}[./-]\d{4})/g,/(\d{2}[./-]\d{2}[./-]\d{4})/g,/(\d{1,2}[:.]\d{2})/g,/(\d{1,2}[h]\s*\d{1,2})/gi,/(?:hoje|agora)\s+(\d{1,2}[:.]\d{2})/gi],confirmacao:[/pix\s+(?:realizado|enviado|conclu[√≠i]do|efetuado|feito|processado)/gi,/transfer[√™e]ncia\s+(?:realizada|conclu[√≠i]da|efetuada)/gi,/pagamento\s+(?:realizado|conclu[√≠i]do|efetuado|feito)/gi,/(?:confirma[√ßc][√£a]o|comprovante)\s+de\s+(?:pagamento|pix)/gi,/(?:sucesso|confirmado|aprovado|conclu[√≠i]do|finalizado)/gi,/(?:feito|realizado)\s+com\s+sucesso/gi]},i={valor:null,dataHora:null,confirmacao:!1,textoEncontrado:[],confiancaOCR:0};for(const s of n.valor)try{const d=[...t.matchAll(s)];for(const m of d){let w=m[1]||m[0];w=w.replace(/r\s*\$\s*/gi,"");const S=parseFloat(w.replace(",","."));if(!isNaN(S)&&S>=this.valorMinimo){i.valor=S,i.textoEncontrado.push(`Valor: R$ ${S.toFixed(2)}`);break}}if(i.valor)break}catch(d){console.log("‚ö†Ô∏è Erro ao buscar valor:",d)}for(const s of n.dataHora)try{const d=t.match(s);if(d){i.dataHora=this.normalizarDataHora(d[0]),i.textoEncontrado.push(`Data/Hora: ${i.dataHora}`);break}}catch(d){console.log("‚ö†Ô∏è Erro ao buscar data/hora:",d)}for(const s of n.confirmacao)try{if(s.test(t)){i.confirmacao=!0,i.textoEncontrado.push("Confirma√ß√£o encontrada");break}}catch(d){console.log("‚ö†Ô∏è Erro ao buscar confirma√ß√£o:",d)}return i.valido=this.validarResultado(i),console.log("üìã Resultado da an√°lise:",i),i}normalizarDataHora(o){try{const t=[/(\d{2})[./-](\d{2})[./-](\d{4})\s+(\d{1,2})[:.](\d{2})/,/(\d{4})[./-](\d{2})[./-](\d{2})\s+(\d{1,2})[:.](\d{2})/,/(\d{2})[./-](\d{2})[./-](\d{4})/,/(\d{1,2})[:.](\d{2})/];let n;for(const i of t)if(n=o.match(i)){if(n[3]&&n[4])return`${n[3].length===4?n[3]:`20${n[3]}`}-${n[2]}-${n[1]}T${n[4].padStart(2,"0")}:${n[5].padStart(2,"0")}:00`;if(n[1]&&n[2]&&n[3])return`${n[3].length===4?n[3]:`20${n[3]}`}-${n[2]}-${n[1]}T12:00:00`;if(n[1]&&n[2])return`${new Date().toISOString().split("T")[0]}T${n[1].padStart(2,"0")}:${n[2].padStart(2,"0")}:00`}return o}catch(t){return console.log("‚ö†Ô∏è Erro ao normalizar data:",t),o}}validarResultado(o){let t=0;return o.valor!==null&&(t+=40),o.confirmacao&&(t+=30),o.dataHora!==null&&(t+=30),t>=70||o.valor!==null&&o.confirmacao}validarTemporalmente(o){if(!o)return{valido:!1,mensagem:"Data/hora n√£o encontrada."};try{const t=new Date(o),n=new Date;if(isNaN(t.getTime()))return{valido:!1,mensagem:"Data/hora inv√°lida."};const i=n-t,s=Math.floor(i/(1e3*60));if(console.log(`‚è∞ Diferen√ßa temporal: ${s} minutos`),s>this.toleranciaMinutos)return{valido:!1,mensagem:`Comprovante expirado h√° ${s-this.toleranciaMinutos} minutos. Fa√ßa novo pagamento.`};const d=this.toleranciaMinutos-s;return{valido:!0,mensagem:`Comprovante dentro do prazo (${d} minutos restantes).`,tempoRestante:d}}catch(t){return console.error("Erro na valida√ß√£o temporal:",t),{valido:!1,mensagem:"Erro ao validar data/hora."}}}async terminar(){this.worker&&(await this.worker.terminate(),this.worker=null)}}const pr=new fr;export{pr as default};
