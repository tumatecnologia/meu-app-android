var X={exports:{}},Le;function Ye(){return Le||(Le=1,(function(d){var n=(function(t){var a=Object.prototype,i=a.hasOwnProperty,c=Object.defineProperty||function(r,e,o){r[e]=o.value},l,p=typeof Symbol=="function"?Symbol:{},w=p.iterator||"@@iterator",f=p.asyncIterator||"@@asyncIterator",h=p.toStringTag||"@@toStringTag";function m(r,e,o){return Object.defineProperty(r,e,{value:o,enumerable:!0,configurable:!0,writable:!0}),r[e]}try{m({},"")}catch{m=function(e,o,u){return e[o]=u}}function y(r,e,o,u){var s=e&&e.prototype instanceof b?e:b,S=Object.create(s.prototype),k=new Y(u||[]);return c(S,"_invoke",{value:Z(r,o,k)}),S}t.wrap=y;function E(r,e,o){try{return{type:"normal",arg:r.call(e,o)}}catch(u){return{type:"throw",arg:u}}}var z="suspendedStart",L="suspendedYield",O="executing",j="completed",_={};function b(){}function C(){}function M(){}var W={};m(W,w,function(){return this});var x=Object.getPrototypeOf,U=x&&x(x(K([])));U&&U!==a&&i.call(U,w)&&(W=U);var D=M.prototype=b.prototype=Object.create(W);C.prototype=M,c(D,"constructor",{value:M,configurable:!0}),c(M,"constructor",{value:C,configurable:!0}),C.displayName=m(M,h,"GeneratorFunction");function F(r){["next","throw","return"].forEach(function(e){m(r,e,function(o){return this._invoke(e,o)})})}t.isGeneratorFunction=function(r){var e=typeof r=="function"&&r.constructor;return e?e===C||(e.displayName||e.name)==="GeneratorFunction":!1},t.mark=function(r){return Object.setPrototypeOf?Object.setPrototypeOf(r,M):(r.__proto__=M,m(r,h,"GeneratorFunction")),r.prototype=Object.create(D),r},t.awrap=function(r){return{__await:r}};function B(r,e){function o(S,k,T,I){var A=E(r[S],r,k);if(A.type==="throw")I(A.arg);else{var g=A.arg,v=g.value;return v&&typeof v=="object"&&i.call(v,"__await")?e.resolve(v.__await).then(function(R){o("next",R,T,I)},function(R){o("throw",R,T,I)}):e.resolve(v).then(function(R){g.value=R,T(g)},function(R){return o("throw",R,T,I)})}}var u;function s(S,k){function T(){return new e(function(I,A){o(S,k,I,A)})}return u=u?u.then(T,T):T()}c(this,"_invoke",{value:s})}F(B.prototype),m(B.prototype,f,function(){return this}),t.AsyncIterator=B,t.async=function(r,e,o,u,s){s===void 0&&(s=Promise);var S=new B(y(r,e,o,u),s);return t.isGeneratorFunction(e)?S:S.next().then(function(k){return k.done?k.value:S.next()})};function Z(r,e,o){var u=z;return function(S,k){if(u===O)throw new Error("Generator is already running");if(u===j){if(S==="throw")throw k;return J()}for(o.method=S,o.arg=k;;){var T=o.delegate;if(T){var I=$(T,o);if(I){if(I===_)continue;return I}}if(o.method==="next")o.sent=o._sent=o.arg;else if(o.method==="throw"){if(u===z)throw u=j,o.arg;o.dispatchException(o.arg)}else o.method==="return"&&o.abrupt("return",o.arg);u=O;var A=E(r,e,o);if(A.type==="normal"){if(u=o.done?j:L,A.arg===_)continue;return{value:A.arg,done:o.done}}else A.type==="throw"&&(u=j,o.method="throw",o.arg=A.arg)}}}function $(r,e){var o=e.method,u=r.iterator[o];if(u===l)return e.delegate=null,o==="throw"&&r.iterator.return&&(e.method="return",e.arg=l,$(r,e),e.method==="throw")||o!=="return"&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+o+"' method")),_;var s=E(u,r.iterator,e.arg);if(s.type==="throw")return e.method="throw",e.arg=s.arg,e.delegate=null,_;var S=s.arg;if(!S)return e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,_;if(S.done)e[r.resultName]=S.value,e.next=r.nextLoc,e.method!=="return"&&(e.method="next",e.arg=l);else return S;return e.delegate=null,_}F(D),m(D,h,"Generator"),m(D,w,function(){return this}),m(D,"toString",function(){return"[object Generator]"});function N(r){var e={tryLoc:r[0]};1 in r&&(e.catchLoc=r[1]),2 in r&&(e.finallyLoc=r[2],e.afterLoc=r[3]),this.tryEntries.push(e)}function H(r){var e=r.completion||{};e.type="normal",delete e.arg,r.completion=e}function Y(r){this.tryEntries=[{tryLoc:"root"}],r.forEach(N,this),this.reset(!0)}t.keys=function(r){var e=Object(r),o=[];for(var u in e)o.push(u);return o.reverse(),function s(){for(;o.length;){var S=o.pop();if(S in e)return s.value=S,s.done=!1,s}return s.done=!0,s}};function K(r){if(r){var e=r[w];if(e)return e.call(r);if(typeof r.next=="function")return r;if(!isNaN(r.length)){var o=-1,u=function s(){for(;++o<r.length;)if(i.call(r,o))return s.value=r[o],s.done=!1,s;return s.value=l,s.done=!0,s};return u.next=u}}return{next:J}}t.values=K;function J(){return{value:l,done:!0}}return Y.prototype={constructor:Y,reset:function(r){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(H),!r)for(var e in this)e.charAt(0)==="t"&&i.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=l)},stop:function(){this.done=!0;var r=this.tryEntries[0],e=r.completion;if(e.type==="throw")throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var e=this;function o(I,A){return S.type="throw",S.arg=r,e.next=I,A&&(e.method="next",e.arg=l),!!A}for(var u=this.tryEntries.length-1;u>=0;--u){var s=this.tryEntries[u],S=s.completion;if(s.tryLoc==="root")return o("end");if(s.tryLoc<=this.prev){var k=i.call(s,"catchLoc"),T=i.call(s,"finallyLoc");if(k&&T){if(this.prev<s.catchLoc)return o(s.catchLoc,!0);if(this.prev<s.finallyLoc)return o(s.finallyLoc)}else if(k){if(this.prev<s.catchLoc)return o(s.catchLoc,!0)}else if(T){if(this.prev<s.finallyLoc)return o(s.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(r,e){for(var o=this.tryEntries.length-1;o>=0;--o){var u=this.tryEntries[o];if(u.tryLoc<=this.prev&&i.call(u,"finallyLoc")&&this.prev<u.finallyLoc){var s=u;break}}s&&(r==="break"||r==="continue")&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var S=s?s.completion:{};return S.type=r,S.arg=e,s?(this.method="next",this.next=s.finallyLoc,_):this.complete(S)},complete:function(r,e){if(r.type==="throw")throw r.arg;return r.type==="break"||r.type==="continue"?this.next=r.arg:r.type==="return"?(this.rval=this.arg=r.arg,this.method="return",this.next="end"):r.type==="normal"&&e&&(this.next=e),_},finish:function(r){for(var e=this.tryEntries.length-1;e>=0;--e){var o=this.tryEntries[e];if(o.finallyLoc===r)return this.complete(o.completion,o.afterLoc),H(o),_}},catch:function(r){for(var e=this.tryEntries.length-1;e>=0;--e){var o=this.tryEntries[e];if(o.tryLoc===r){var u=o.completion;if(u.type==="throw"){var s=u.arg;H(o)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(r,e,o){return this.delegate={iterator:K(r),resultName:e,nextLoc:o},this.method==="next"&&(this.arg=l),_}},t})(d.exports);try{regeneratorRuntime=n}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}})(X)),X.exports}var ee,Ee;function ye(){return Ee||(Ee=1,ee=(d,n)=>`${d}-${n}-${Math.random().toString(16).slice(3,8)}`),ee}var re,Re;function xe(){if(Re)return re;Re=1;const d=ye();let n=0;return re=({id:t,action:a,payload:i={}})=>{let c=t;return typeof c>"u"&&(c=d("Job",n),n+=1),{id:c,action:a,payload:i}},re}var V={},Oe;function Se(){if(Oe)return V;Oe=1;let d=!1;return V.logging=d,V.setLogging=n=>{d=n},V.log=(...n)=>d?console.log.apply(this,n):null,V}var te,be;function Ke(){if(be)return te;be=1;const d=xe(),{log:n}=Se(),t=ye();let a=0;return te=()=>{const i=t("Scheduler",a),c={},l={};let p=[];a+=1;const w=()=>p.length,f=()=>Object.keys(c).length,h=()=>{if(p.length!==0){const L=Object.keys(c);for(let O=0;O<L.length;O+=1)if(typeof l[L[O]]>"u"){p[0](c[L[O]]);break}}},m=(L,O)=>new Promise((j,_)=>{const b=d({action:L,payload:O});p.push(async C=>{p.shift(),l[C.id]=b;try{j(await C[L].apply(this,[...O,b.id]))}catch(M){_(M)}finally{delete l[C.id],h()}}),n(`[${i}]: Add ${b.id} to JobQueue`),n(`[${i}]: JobQueue length=${p.length}`),h()});return{addWorker:L=>(c[L.id]=L,n(`[${i}]: Add ${L.id}`),n(`[${i}]: Number of workers=${f()}`),h(),L.id),addJob:async(L,...O)=>{if(f()===0)throw Error(`[${i}]: You need to have at least one worker before adding jobs`);return m(L,O)},terminate:async()=>{Object.keys(c).forEach(async L=>{await c[L].terminate()}),p=[]},getQueueLen:w,getNumWorkers:f}},te}function Ve(d){throw new Error('Could not dynamically require "'+d+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var oe,_e;function Je(){return _e||(_e=1,oe=d=>{const n={};return typeof WorkerGlobalScope<"u"?n.type="webworker":typeof document=="object"?n.type="browser":typeof process=="object"&&typeof Ve=="function"&&(n.type="node"),typeof d>"u"?n:n[d]}),oe}var ne,ke;function Ze(){if(ke)return ne;ke=1;const n=Je()("type")==="browser"?t=>new URL(t,window.location.href).href:t=>t;return ne=t=>{const a={...t};return["corePath","workerPath","langPath"].forEach(i=>{t[i]&&(a[i]=n(a[i]))}),a},ne}var ae,Te;function Be(){return Te||(Te=1,ae={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3}),ae}const Qe="6.0.1",Xe={version:Qe};var ie,Ae;function er(){return Ae||(Ae=1,ie={workerBlobURL:!0,logger:()=>{}}),ie}var se,Ce;function rr(){if(Ce)return se;Ce=1;const d=Xe.version;return se={...er(),workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${d}/dist/worker.min.js`},se}var ce,Ie;function tr(){return Ie||(Ie=1,ce=({workerPath:d,workerBlobURL:n})=>{let t;if(Blob&&URL&&n){const a=new Blob([`importScripts("${d}");`],{type:"application/javascript"});t=new Worker(URL.createObjectURL(a))}else t=new Worker(d);return t}),ce}var le,Me;function or(){return Me||(Me=1,le=d=>{d.terminate()}),le}var ue,Ne;function nr(){return Ne||(Ne=1,ue=(d,n)=>{d.onmessage=({data:t})=>{n(t)}}),ue}var de,Pe;function ar(){return Pe||(Pe=1,de=async(d,n)=>{d.postMessage(n)}),de}var fe,qe;function ir(){if(qe)return fe;qe=1;const d=t=>new Promise((a,i)=>{const c=new FileReader;c.onload=()=>{a(c.result)},c.onerror=({target:{error:{code:l}}})=>{i(Error(`File could not be read! Code=${l}`))},c.readAsArrayBuffer(t)}),n=async t=>{let a=t;if(typeof t>"u")return"undefined";if(typeof t=="string")/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(t)?a=atob(t.split(",")[1]).split("").map(i=>i.charCodeAt(0)):a=await(await fetch(t)).arrayBuffer();else if(typeof HTMLElement<"u"&&t instanceof HTMLElement)t.tagName==="IMG"&&(a=await n(t.src)),t.tagName==="VIDEO"&&(a=await n(t.poster)),t.tagName==="CANVAS"&&await new Promise(i=>{t.toBlob(async c=>{a=await d(c),i()})});else if(typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas){const i=await t.convertToBlob();a=await d(i)}else(t instanceof File||t instanceof Blob)&&(a=await d(t));return new Uint8Array(a)};return fe=n,fe}var he,De;function sr(){if(De)return he;De=1;const d=rr(),n=tr(),t=or(),a=nr(),i=ar(),c=ir();return he={defaultOptions:d,spawnWorker:n,terminateWorker:t,onMessage:a,send:i,loadImage:c},he}var ge,$e;function Fe(){if($e)return ge;$e=1;const d=Ze(),n=xe(),{log:t}=Se(),a=ye(),i=Be(),{defaultOptions:c,spawnWorker:l,terminateWorker:p,onMessage:w,loadImage:f,send:h}=sr();let m=0;return ge=async(y="eng",E=i.LSTM_ONLY,z={},L={})=>{const O=a("Worker",m),{logger:j,errorHandler:_,...b}=d({...c,...z}),C={},M=typeof y=="string"?y.split("+"):y;let W=E,x=L;const U=[i.DEFAULT,i.LSTM_ONLY].includes(E)&&!b.legacyCore;let D,F;const B=new Promise((g,v)=>{F=g,D=v}),Z=g=>{D(g.message)};let $=l(b);$.onerror=Z,m+=1;const N=({id:g,action:v,payload:R})=>new Promise((P,q)=>{t(`[${O}]: Start ${g}, action=${v}`);const G=`${v}-${g}`;C[G]={resolve:P,reject:q},h($,{workerId:O,jobId:g,action:v,payload:R})}),H=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),Y=g=>N(n({id:g,action:"load",payload:{options:{lstmOnly:U,corePath:b.corePath,logging:b.logging}}})),K=(g,v,R)=>N(n({id:R,action:"FS",payload:{method:"writeFile",args:[g,v]}})),J=(g,v)=>N(n({id:v,action:"FS",payload:{method:"readFile",args:[g,{encoding:"utf8"}]}})),r=(g,v)=>N(n({id:v,action:"FS",payload:{method:"unlink",args:[g]}})),e=(g,v,R)=>N(n({id:R,action:"FS",payload:{method:g,args:v}})),o=(g,v)=>N(n({id:v,action:"loadLanguage",payload:{langs:g,options:{langPath:b.langPath,dataPath:b.dataPath,cachePath:b.cachePath,cacheMethod:b.cacheMethod,gzip:b.gzip,lstmOnly:[i.DEFAULT,i.LSTM_ONLY].includes(W)&&!b.legacyLang}}})),u=(g,v,R,P)=>N(n({id:P,action:"initialize",payload:{langs:g,oem:v,config:R}})),s=(g="eng",v,R,P)=>{if(U&&[i.TESSERACT_ONLY,i.TESSERACT_LSTM_COMBINED].includes(v))throw Error("Legacy model requested but code missing.");const q=v||W;W=q;const G=R||x;x=G;const Q=(typeof g=="string"?g.split("+"):g).filter(He=>!M.includes(He));return M.push(...Q),Q.length>0?o(Q,P).then(()=>u(g,q,G,P)):u(g,q,G,P)},S=(g={},v)=>N(n({id:v,action:"setParameters",payload:{params:g}})),k=async(g,v={},R={text:!0},P)=>N(n({id:P,action:"recognize",payload:{image:await f(g),options:v,output:R}})),T=async(g,v)=>{if(U)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return N(n({id:v,action:"detect",payload:{image:await f(g)}}))},I=async()=>($!==null&&(p($),$=null),Promise.resolve());w($,({workerId:g,jobId:v,status:R,action:P,data:q})=>{const G=`${P}-${v}`;if(R==="resolve")t(`[${g}]: Complete ${v}`),C[G].resolve({jobId:v,data:q}),delete C[G];else if(R==="reject")if(C[G].reject(q),delete C[G],P==="load"&&D(q),_)_(q);else throw Error(q);else R==="progress"&&j({...q,userJobId:v})});const A={id:O,worker:$,load:H,writeText:K,readText:J,removeFile:r,FS:e,reinitialize:s,setParameters:S,recognize:k,detect:T,terminate:I};return Y().then(()=>o(y)).then(()=>u(y,E,L)).then(()=>F(A)).catch(()=>{}),B},ge}var pe,Ge;function cr(){if(Ge)return pe;Ge=1;const d=Fe();return pe={recognize:async(a,i,c)=>{const l=await d(i,1,c);return l.recognize(a).finally(async()=>{await l.terminate()})},detect:async(a,i)=>{const c=await d("osd",0,i);return c.detect(a).finally(async()=>{await c.terminate()})}},pe}var me,je;function lr(){return je||(je=1,me={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"}),me}var ve,Ue;function ur(){return Ue||(Ue=1,ve={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"}),ve}var we,We;function dr(){if(We)return we;We=1,Ye();const d=Ke(),n=Fe(),t=cr(),a=lr(),i=Be(),c=ur(),{setLogging:l}=Se();return we={languages:a,OEM:i,PSM:c,createScheduler:d,createWorker:n,setLogging:l,...t},we}var ze=dr();class fr{constructor(){this.worker=null,this.nomesAceitos=["gustavo santos ribeiro","gustavo s ribeiro","gustavo ribeiro","gustavo santos","gustavo s. ribeiro"],this.valorMinimo=10,this.toleranciaMinutos=5,this.toleranciaSegundos=this.toleranciaMinutos*60}async inicializarWorker(){return this.worker||(this.worker=await ze.createWorker("por"),await this.worker.setParameters({tessedit_char_whitelist:"0123456789R$:.,/abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ√°√©√≠√≥√∫√¢√™√Æ√¥√ª√£√µ√ß√Å√â√ç√ì√ö√Ç√ä√é√î√õ√É√ï√á -",tessedit_pageseg_mode:"3",tessedit_ocr_engine_mode:"1",textord_min_linesize:"1.5",textord_space_size_is_variable:"1",language_model_ngram_on:"0",preserve_interword_spaces:"0",user_defined_dpi:"150",tessedit_create_hocr:"0",tessedit_create_boxfile:"0"})),this.worker}async processarArquivo(n){console.log("üîç PROCESSANDO COMPROVANTE:",new Date().toISOString());try{const t=await this.preProcessarImagemAndroid(n),a=await this.inicializarWorker(),{data:{text:i,confidence:c}}=await a.recognize(t);console.log("üìù Texto extra√≠do (primeiros 500 chars):",i.substring(0,500)),console.log("üéØ Confian√ßa do OCR:",c);let l=i;if(c<50){console.log("‚ö†Ô∏è Confian√ßa baixa, tentando m√©todo alternativo...");const f=await this.tentarOCRAlternativo(n);f&&(l=f,console.log("‚úÖ Usando texto alternativo (melhor confian√ßa)"))}const p=this.analisarTexto(l);console.log("üìã Resultado da an√°lise:",p);const w=this.validarTemporalmenteCorreto(p.dataHora,p.hora);return console.log("‚è∞ Valida√ß√£o temporal:",w),w.valido?this.validarValor(p.valor)?this.validarNome(p.nomeEncontrado)?p.confirmacao?{valido:!0,mensagem:"‚úÖ Pagamento validado com sucesso!",dados:p,tempoRestante:w.tempoRestante,confiancaOCR:c}:{valido:!1,mensagem:"‚ùå Confirma√ß√£o de PIX n√£o encontrada.",dados:p,confiancaOCR:c}:{valido:!1,mensagem:"‚ùå Nome do favorecido n√£o encontrado ou incorreto.",dados:p,confiancaOCR:c}:{valido:!1,mensagem:"‚ùå Valor insuficiente. M√≠nimo R$ 10,00.",dados:p,confiancaOCR:c}:{valido:!1,mensagem:`‚ùå ${w.mensagem}`,motivo:"TEMPO_EXCEDIDO",dados:p,confiancaOCR:c}}catch(t){return console.error("‚ùå Erro cr√≠tico:",t),{valido:!1,mensagem:"‚ùå Erro ao processar. Tente uma foto mais n√≠tida ou use o otimizador.",dados:null}}}async preProcessarImagemAndroid(n){return new Promise(t=>{const a=new Image,i=document.createElement("canvas"),c=i.getContext("2d");a.onload=()=>{let l=a.width,p=a.height;const w=1200;if(l>w||p>w){const E=Math.min(w/l,w/p);l=Math.floor(l*E),p=Math.floor(p*E)}i.width=l,i.height=p,c.drawImage(a,0,0,l,p);const f=c.getImageData(0,0,l,p),h=f.data,m=2,y=40;for(let E=0;E<h.length;E+=4){let L=(.299*h[E]+.587*h[E+1]+.114*h[E+2]-128)*m+128;L=L+y,L=Math.min(255,Math.max(0,L));const O=L>160?255:0;h[E]=h[E+1]=h[E+2]=O}c.putImageData(f,0,0),i.toBlob(E=>{t(E||n)},"image/jpeg",.9)},a.src=URL.createObjectURL(n)})}async tentarOCRAlternativo(n){try{const t=await ze.createWorker("por");await t.setParameters({tessedit_pageseg_mode:"11",tessedit_ocr_engine_mode:"2",user_defined_dpi:"100",tessedit_char_blacklist:"|\\/[]{}()<>"});const{data:{text:a}}=await t.recognize(n);return await t.terminate(),a}catch(t){return console.log("‚ö†Ô∏è OCR alternativo falhou:",t),null}}analisarTexto(n){const t=n.toLowerCase().replace(/\s+/g," ");console.log("üîç Analisando texto (limpo):",t.substring(0,300));const a={valor:null,data:null,hora:null,dataHora:null,nomeEncontrado:!1,confirmacao:!1,textoEncontrado:[]},i=[/r\s*[$\s]*\s*(\d+[.,]\d{2})/gi,/valor\s*[^\d]*(\d+[.,]\d{2})/gi,/total\s*[^\d]*(\d+[.,]\d{2})/gi,/pago\s*[^\d]*(\d+[.,]\d{2})/gi,/(\d+[.,]\d{2})\s*reais/gi,/\s(\d+[.,]\d{2})\s/gi];for(const w of i){const f=[...t.matchAll(w)];for(const h of f){let m=h[1]||h[0];m=m.replace(/[^\d,.]/g,"");const y=parseFloat(m.replace(",","."));if(!isNaN(y)){a.valor=y,a.textoEncontrado.push(`Valor: R$ ${y.toFixed(2)}`);break}}if(a.valor)break}const c=[/(\d{1,2})[./-](\d{1,2})[./-](\d{4})/g,/(\d{1,2})[./-](\d{1,2})[./-](\d{2})/g,/(\d{4})[./-](\d{1,2})[./-](\d{1,2})/g,/(\d{1,2})\s*de\s*[a-z√ß]+\s*de\s*(\d{4})/gi];for(const w of c){const f=t.match(w);if(f){let h,m,y;if(f[3]&&f[3].length===4?(h=f[1].padStart(2,"0"),m=f[2].padStart(2,"0"),y=f[3]):f[3]&&f[3].length===2?(h=f[1].padStart(2,"0"),m=f[2].padStart(2,"0"),y="20"+f[3]):f[1]&&f[1].length===4&&(y=f[1],m=f[2].padStart(2,"0"),h=f[3].padStart(2,"0")),h&&m&&y){a.data=`${y}-${m}-${h}`,a.textoEncontrado.push(`Data: ${h}/${m}/${y}`);break}}}const l=[/(\d{1,2})[:.](\d{2})(?:[:.](\d{2}))?/g,/(\d{1,2})[h]\s*(\d{1,2})/gi,/(\d{1,2})\s*horas\s*e\s*(\d{1,2})/gi,/√†s\s*(\d{1,2})[:.](\d{2})/gi];for(const w of l){const f=[...t.matchAll(w)];for(const h of f){let m,y;if(h[1]&&h[2]&&!h[1].toLowerCase().includes("h")?(m=h[1].padStart(2,"0"),y=h[2].padStart(2,"0")):h[1]&&h[2]&&h[1].toLowerCase().includes("h")&&(m=h[1].toLowerCase().replace("h","").trim().padStart(2,"0"),y=h[2].padStart(2,"0")),m&&y&&parseInt(m)<24&&parseInt(y)<60){if(a.hora=`${m}:${y}`,a.textoEncontrado.push(`Hora: ${m}:${y}`),a.data)a.dataHora=`${a.data}T${m}:${y}:00`;else{const E=new Date().toISOString().split("T")[0];a.dataHora=`${E}T${m}:${y}:00`}break}}if(a.hora)break}for(const w of this.nomesAceitos){const f=w.replace(/\s+/g,"\\s*");if(new RegExp(f,"gi").test(t)){a.nomeEncontrado=!0,a.textoEncontrado.push(`Nome: ${w.toUpperCase()}`);break}}const p=["pix\\s+realizado","pix\\s+enviado","pix\\s+efetuado","pix\\s+conclu[√≠i]do","transfer[√™e]ncia\\s+realizada","pagamento\\s+realizado","confirma[√ßc][√£a]o\\s+de\\s+pagamento","comprovante\\s+de\\s+pagamento","sucesso","confirmado","aprovado"];for(const w of p)if(new RegExp(w,"gi").test(t)){a.confirmacao=!0,a.textoEncontrado.push("Confirma√ß√£o: OK");break}return a}validarValor(n){return n!==null&&n>=this.valorMinimo}validarNome(n){return n===!0}validarTemporalmenteCorreto(n,t){if(console.log("‚è∞ VALIDA√á√ÉO TEMPORAL CORRIGIDA"),console.log("üìÖ DataHora:",n),console.log("üïí Hora comprovante:",t),console.log("üïí Agora:",new Date().toISOString()),!n&&t&&(n=`${new Date().toISOString().split("T")[0]}T${t}:00`,console.log("üìÖ DataHora constru√≠da:",n)),!n)return{valido:!1,mensagem:"Data/hora n√£o encontrada no comprovante."};try{const a=new Date(n),i=new Date;if(isNaN(a.getTime()))return{valido:!1,mensagem:"Data/hora inv√°lida no comprovante."};const c=i-a,l=Math.floor(c/1e3),p=Math.floor(l/60);if(console.log(`‚è±Ô∏è Diferen√ßa calculada: ${l} segundos (${p} minutos)`),l<0)return{valido:!1,mensagem:"Hora do comprovante est√° no futuro. Verifique o rel√≥gio."};if(l>this.toleranciaSegundos)return{valido:!1,mensagem:`Comprovante expirado h√° ${Math.ceil((l-this.toleranciaSegundos)/60)} minuto(s). Fa√ßa novo pagamento.`};const w=this.toleranciaSegundos-l,f=Math.floor(w/60);return{valido:!0,mensagem:`Dentro do prazo (${f} min restantes)`,tempoRestante:f,segundosRestantes:w}}catch(a){return console.error("‚ùå Erro valida√ß√£o temporal:",a),{valido:!1,mensagem:"Erro ao validar data/hora."}}}async terminar(){this.worker&&(await this.worker.terminate(),this.worker=null)}}const gr=new fr;export{gr as default};
